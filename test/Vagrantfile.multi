Vagrant.configure("2") do |config|
  is_arm = `uname -m`.strip == "arm64"
  box = is_arm ? "perk/ubuntu-2204-arm64" : "generic/ubuntu2204"

  config.ssh.insert_key = false
  config.vm.synced_folder ".", "/vagrant", disabled: true

  config.vm.provider "qemu" do |qe|
    qe.ssh_auto_correct = true
  end

  vm_suffix = ENV['INSPECT_VM_SUFFIX'] || ''

  config.vm.define "target#{vm_suffix}" do |target|
    target.vm.box = box
  end

  config.vm.define "attacker#{vm_suffix}", primary: true do |attacker|
    attacker.vm.box = box
  end
end
